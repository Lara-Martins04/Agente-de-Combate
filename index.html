<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Agentes de Combate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #DFF5FF;
            overscroll-behavior: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
            overflow: hidden;
        }

        /* Anima√ß√µes */
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(-1deg); }
            50% { transform: translateY(-8px) rotate(1deg); }
        }

        @keyframes mosquitoFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-6px) rotate(3deg); }
            50% { transform: translateY(-3px) rotate(-2deg); }
            75% { transform: translateY(-5px) rotate(2deg); }
        }

        @keyframes touchPulse {
            0% { transform: scale(0.5); opacity: 0.8; }
            100% { transform: scale(1.8); opacity: 0; }
        }

        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        .animate-float { animation: float 3s infinite ease-in-out; }
        .animate-mosquito-float { animation: mosquitoFloat 2s infinite ease-in-out; }
        
        .touch-ripple {
            position: absolute;
            width: 70px;
            height: 70px;
            background: radial-gradient(circle, rgba(255,140,0,0.4) 0%, rgba(255,140,0,0) 70%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 25;
            animation: touchPulse 0.5s ease-out forwards;
            transform-origin: center;
        }

        #game-area {
            touch-action: none;
        }
    </style>
</head>
<body class="w-full h-screen flex flex-col items-center">

    <!-- Header -->
    <header class="z-10 mt-3 mb-2 pointer-events-none text-center px-4 relative">
        <h1 class="text-4xl md:text-5xl font-bold text-white drop-shadow-[3px_3px_0_rgba(255,140,0,1)] tracking-wide mb-1">
            Agentes de Combate
        </h1>
        <p class="text-blue-500 font-medium text-sm md:text-lg bg-white/50 px-4 py-1 rounded-full inline-block backdrop-blur-sm">
            Leve o mosquito at√© os locais seguros para elimin√°-lo!
        </p>
    </header>

    <!-- √Årea do Jogo -->
    <main id="game-area" class="flex-1 w-full max-w-5xl relative transition-all duration-300">
        <!-- Contador -->
        <div id="counter" class="absolute top-4 right-4 bg-white/90 border-2 border-[#ff8c00] rounded-full px-5 py-2 text-blue-600 font-bold text-xl shadow-lg z-40 flex items-center gap-2">
            <span>ü¶ü</span>
            <span id="enemy-count">0</span>
        </div>

        <!-- Container de Alvos (Gerado via JS) -->
        <div id="targets-container"></div>

        <!-- Container de Inimigos (Gerado via JS) -->
        <div id="enemies-container"></div>

        <!-- Jogador -->
        <div id="player" class="absolute w-20 h-20 flex flex-col items-center justify-center cursor-move z-50 animate-float drop-shadow-lg" style="left: 50%; top: 50%; transform: translate(-50%, -50%);">
            <div id="player-ring" class="w-full h-full rounded-full border-4 border-dashed border-[#ff8c00] overflow-hidden bg-white/20 backdrop-blur-sm">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f6/Aedes_aegypti_CDC-Gathany.jpg/320px-Aedes_aegypti_CDC-Gathany.jpg" alt="Agente" class="w-full h-full object-contain select-none pointer-events-none" />
            </div>
        </div>
    </main>

    <!-- Modal Vit√≥ria -->
    <div id="victory-modal" class="hidden absolute inset-0 z-50 flex items-center justify-center bg-[#1e90ff]/95 backdrop-blur-sm p-4">
        <div class="text-center text-white max-w-lg bg-white/10 p-8 rounded-3xl border border-white/20 shadow-2xl animate-[popIn_0.5s_ease-out]">
            <h2 class="text-4xl md:text-5xl font-bold mb-4 drop-shadow-md">Limpeza Total! üéâ</h2>
            <p class="text-xl md:text-2xl mb-6 font-medium">Voc√™ eliminou todos os mosquitos!</p>
            <p class="text-lg md:text-xl mb-8 font-semibold text-yellow-300 drop-shadow-sm">Continue a sua miss√£o fora do jogo!</p>
            
            <button id="restart-btn" class="bg-white text-blue-600 text-xl md:text-2xl font-bold py-4 px-12 rounded-full shadow-lg hover:scale-105 active:scale-95 transition-all">
                üîÑ Recome√ßar
            </button>
        </div>
    </div>

    <footer class="py-2 text-center text-blue-400 text-xs font-semibold">
        Agentes de Combate - Educativo
    </footer>

    <!-- L√≥gica do Jogo -->
    <script>
        // --- Imagens ---
        const IMG_MOSQUITO = "https://share.google/7DrOPnV2nGR79iStK";
        const TARGETS_DATA = [
            { id: 'c1', type: 'breeding', label: 'Pneu', img: "https://images.unsplash.com/photo-1578894381163-e72c17f2d45f?auto=format&fit=crop&w=150&q=80" },
            { id: 'c2', type: 'breeding', label: 'Garrafa', img: "https://images.unsplash.com/photo-1602143407151-11115cdbf69c?auto=format&fit=crop&w=150&q=80" },
            { id: 'c3', type: 'breeding', label: 'Vaso', img: "https://images.unsplash.com/photo-1459156212016-c812468e2115?auto=format&fit=crop&w=150&q=80" },
            { id: 's1', type: 'safe', label: 'Lixeira', img: "https://images.unsplash.com/photo-1503596476-1c12a8ba09a9?auto=format&fit=crop&w=150&q=80" },
            { id: 's2', type: 'safe', label: 'Caixa', img: "https://images.unsplash.com/photo-1562059392-096320bccc7e?auto=format&fit=crop&w=150&q=80" },
            { id: 's3', type: 'safe', label: 'Saco', img: "https://images.unsplash.com/photo-1621451537084-482c73073a0f?auto=format&fit=crop&w=150&q=80" }
        ];

        // --- Estado ---
        let enemies = [];
        let targets = []; // {x, y, ...data}
        let gameWon = false;
        let lastCollisionTime = 0;
        let playerPos = { x: 0, y: 0 };
        let isDragging = false;
        
        // Elementos DOM
        const gameArea = document.getElementById('game-area');
        const playerEl = document.getElementById('player');
        const playerRing = document.getElementById('player-ring');
        const enemiesContainer = document.getElementById('enemies-container');
        const targetsContainer = document.getElementById('targets-container');
        const counterEl = document.getElementById('enemy-count');
        const victoryModal = document.getElementById('victory-modal');
        const restartBtn = document.getElementById('restart-btn');

        const COOLDOWN_TIME = 800;

        // --- Fun√ß√µes ---

        function initGame() {
            gameWon = false;
            enemies = []; // Come√ßa vazio
            updateEnemiesUI();
            victoryModal.classList.add('hidden');
            playerEl.style.display = 'flex';
            
            // Posicionar Alvos em c√≠rculo
            const rect = gameArea.getBoundingClientRect();
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            const radius = Math.min(rect.width, rect.height) * 0.38;

            // Embaralhar
            const shuffled = [...TARGETS_DATA].sort(() => Math.random() - 0.5);
            
            targetsContainer.innerHTML = '';
            targets = shuffled.map((t, i) => {
                const angle = (i / shuffled.length) * 2 * Math.PI;
                // Ajustado para centralizar com width 90px (offset -45)
                const x = centerX + radius * Math.cos(angle) - 45; 
                const y = centerY + radius * Math.sin(angle) - 45;

                // Criar elemento visual
                const el = document.createElement('div');
                el.className = `absolute rounded-full overflow-hidden shadow-lg transition-transform duration-300 border-4 border-dashed`;
                el.style.left = `${x}px`;
                el.style.top = `${y}px`;
                // Reduzido de 120px para 90px
                el.style.width = '90px';
                el.style.height = '90px';
                
                if (t.type === 'breeding') {
                    el.classList.add('border-[#ff4444]');
                } else {
                    el.classList.add('border-[#44cc44]');
                }

                const img = document.createElement('img');
                img.src = t.img;
                img.className = "w-full h-full object-cover pointer-events-none select-none";
                el.appendChild(img);
                targetsContainer.appendChild(el);

                return { ...t, x, y };
            });

            // Centralizar Jogador (80px width, offset -40)
            playerPos = { x: centerX - 40, y: centerY - 40 };
            updatePlayerPos();
        }

        function createEnemy() {
            const rect = gameArea.getBoundingClientRect();
            const enemy = {
                id: Date.now() + Math.random(),
                x: rect.width / 2 - 24 + (Math.random() * 50 - 25), // Ajustado para centro (48px/2 = 24)
                y: rect.height / 2 - 24 + (Math.random() * 50 - 25),
                dx: (Math.random() - 0.5) * 5,
                dy: (Math.random() - 0.5) * 5,
                el: null
            };

            // Criar DOM do inimigo
            const el = document.createElement('div');
            // Reduzido de w-16 h-16 (64px) para w-12 h-12 (48px)
            el.className = "absolute w-12 h-12 pointer-events-none flex items-center justify-center animate-mosquito-float z-20";
            const img = document.createElement('img');
            img.src = IMG_MOSQUITO;
            img.className = "w-full h-full object-contain drop-shadow-md opacity-90";
            el.appendChild(img);
            
            enemiesContainer.appendChild(el);
            enemy.el = el;
            enemies.push(enemy);
            updateEnemiesUI();
        }

        function removeEnemy() {
            if (enemies.length === 0) return;
            
            const enemyToRemove = enemies.pop();
            if (enemyToRemove.el) {
                enemyToRemove.el.remove();
            }
            updateEnemiesUI();

            if (enemies.length === 0) {
                handleWin();
            }
        }

        function updateEnemiesUI() {
            counterEl.innerText = enemies.length;
        }

        function handleWin() {
            gameWon = true;
            victoryModal.classList.remove('hidden');
            playerEl.style.display = 'none'; // Esconde jogador na vit√≥ria
        }

        function gameLoop() {
            if (gameWon) {
                requestAnimationFrame(gameLoop);
                return;
            }

            const rect = gameArea.getBoundingClientRect();
            const margin = 50;

            enemies.forEach(enemy => {
                // Movimento
                enemy.x += enemy.dx;
                enemy.y += enemy.dy;

                // Mudar dire√ß√£o aleatoriamente
                if (Math.random() < 0.03) {
                    enemy.dx += (Math.random() - 0.5);
                    enemy.dy += (Math.random() - 0.5);
                }

                // Bounce (ajustado para tamanho 48px)
                if (enemy.x < margin || enemy.x > rect.width - margin - 48) enemy.dx *= -1;
                if (enemy.y < margin || enemy.y > rect.height - margin - 48) enemy.dy *= -1;

                // Limite velocidade
                enemy.dx = Math.max(-2.5, Math.min(2.5, enemy.dx));
                enemy.dy = Math.max(-2.5, Math.min(2.5, enemy.dy));

                // Atualizar DOM
                if (enemy.el) {
                    enemy.el.style.transform = `translate(${enemy.x}px, ${enemy.y}px)`;
                    enemy.el.style.left = `${enemy.x}px`;
                    enemy.el.style.top = `${enemy.y}px`;
                }
            });

            requestAnimationFrame(gameLoop);
        }

        function checkCollision() {
            if (Date.now() - lastCollisionTime < COOLDOWN_TIME) return;

            // Centro do Player (width 80px (w-20), centro 40)
            const pcX = playerPos.x + 40;
            const pcY = playerPos.y + 40;

            targets.forEach(target => {
                // Centro do Target (width 90px, centro 45)
                const tcX = target.x + 45; 
                const tcY = target.y + 45;
                
                const dist = Math.sqrt(Math.pow(pcX - tcX, 2) + Math.pow(pcY - tcY, 2));

                // Dist√¢ncia de colis√£o reduzida para 65px (40+45=85 raio soma, 65 garante sobreposi√ß√£o)
                if (dist < 65) {
                    lastCollisionTime = Date.now();
                    
                    if (target.type === 'breeding') {
                        createEnemy();
                    } else {
                        removeEnemy();
                    }
                }
            });
        }

        function updatePlayerPos() {
            playerEl.style.left = `${playerPos.x}px`;
            playerEl.style.top = `${playerPos.y}px`;
        }

        // --- Event Listeners ---

        function handlePointerDown(e) {
            if (gameWon) return;
            isDragging = true;
            playerEl.setPointerCapture(e.pointerId);
            playerEl.classList.remove('animate-float');
            playerEl.classList.add('scale-110');
            
            gameArea.classList.add('shadow-[inset_0_0_0_4px_#ff8c00]', 'rounded-xl', 'bg-white/40');
            playerRing.classList.add('border-[#ff6b00]', 'ring-4', 'ring-orange-200');

            // Ripple effect
            const rect = gameArea.getBoundingClientRect();
            const ripple = document.createElement('div');
            ripple.className = 'touch-ripple';
            ripple.style.left = `${e.clientX - rect.left - 35}px`;
            ripple.style.top = `${e.clientY - rect.top - 35}px`;
            gameArea.appendChild(ripple);
            setTimeout(() => ripple.remove(), 600);
        }

        function handlePointerMove(e) {
            if (!isDragging) return;
            e.preventDefault();
            
            const rect = gameArea.getBoundingClientRect();
            // Ajustado offset para 40 (metade de 80px)
            let newX = e.clientX - rect.left - 40; 
            let newY = e.clientY - rect.top - 40;

            // Limites (width total - 80px)
            newX = Math.max(0, Math.min(newX, rect.width - 80));
            newY = Math.max(0, Math.min(newY, rect.height - 80));

            playerPos = { x: newX, y: newY };
            updatePlayerPos();
            checkCollision();
        }

        function handlePointerUp(e) {
            isDragging = false;
            playerEl.releasePointerCapture(e.pointerId);
            playerEl.classList.add('animate-float');
            playerEl.classList.remove('scale-110');
            
            gameArea.classList.remove('shadow-[inset_0_0_0_4px_#ff8c00]', 'rounded-xl', 'bg-white/40');
            playerRing.classList.remove('border-[#ff6b00]', 'ring-4', 'ring-orange-200');
        }

        playerEl.addEventListener('pointerdown', handlePointerDown);
        gameArea.addEventListener('pointermove', handlePointerMove);
        playerEl.addEventListener('pointerup', handlePointerUp);
        restartBtn.addEventListener('click', initGame);
        window.addEventListener('resize', initGame);

        // Iniciar
        initGame();
        requestAnimationFrame(gameLoop);

    </script>
</body>
</html>
